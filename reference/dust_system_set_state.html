<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Set system state — dust_system_set_state • dust2</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Set system state — dust_system_set_state"><meta name="description" content="Set system state.  Takes a multidimensional array (2- or 3d
depending on if the system is grouped or not).  Dimensions of
length 1 will be recycled as appropriate.  For continuous time
systems, we will initialise the solver immediately after setting
state, which may cause errors if your initial state is invalid for
your system.  There are many ways that you can use this function
to set different fractions of state (a subset of states, particles
or parameter groups, recycling over any dimensions that are
missing).  Please see the Examples section for usage."><meta property="og:description" content="Set system state.  Takes a multidimensional array (2- or 3d
depending on if the system is grouped or not).  Dimensions of
length 1 will be recycled as appropriate.  For continuous time
systems, we will initialise the solver immediately after setting
state, which may cause errors if your initial state is invalid for
your system.  There are many ways that you can use this function
to set different fractions of state (a subset of states, particles
or parameter groups, recycling over any dimensions that are
missing).  Please see the Examples section for usage."><meta property="og:image" content="https://mrc-ide.github.io/dust2/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dust2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.28</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/dust2.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/design.html">Principles and design of dust</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/data.html">Comparing dust systems to data</a></li>
    <li><a class="dropdown-item" href="../articles/details.html">Details</a></li>
    <li><a class="dropdown-item" href="../articles/packaging.html">Packaging dust systems</a></li>
    <li><a class="dropdown-item" href="../articles/periodic.html">Periodic variables details</a></li>
    <li><a class="dropdown-item" href="../articles/writing.html">Writing dust2 systems</a></li>
    <li><a class="dropdown-item" href="../articles/migrating.html">Migrating from dust 1.x.x</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/dust2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Set system state</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/dust2/blob/main/R/interface.R" class="external-link"><code>R/interface.R</code></a></small>
      <div class="d-none name"><code>dust_system_set_state.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Set system state.  Takes a multidimensional array (2- or 3d
depending on if the system is grouped or not).  Dimensions of
length 1 will be recycled as appropriate.  For continuous time
systems, we will initialise the solver immediately after setting
state, which may cause errors if your initial state is invalid for
your system.  There are many ways that you can use this function
to set different fractions of state (a subset of states, particles
or parameter groups, recycling over any dimensions that are
missing).  Please see the Examples section for usage.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dust_system_set_state</span><span class="op">(</span></span>
<span>  <span class="va">sys</span>,</span>
<span>  <span class="va">state</span>,</span>
<span>  index_state <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  index_particle <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  index_group <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sys">sys<a class="anchor" aria-label="anchor" href="#arg-sys"></a></dt>
<dd><p>A <code>dust_system</code> object</p></dd>


<dt id="arg-state">state<a class="anchor" aria-label="anchor" href="#arg-state"></a></dt>
<dd><p>A matrix or array of state.  If ungrouped, the
dimension order expected is state x particle.  If grouped the
order is state x particle x group.  If you have a grouped system
with 1 particle and <code>preserve_state_dimension = FALSE</code> then the
state has size state x group.  You can omit higher dimensions,
so if you pass a vector it will be treated as if all higher
dimensions are length 1 (or if you have a grouped system you
can provide a matrix and treat it as if the third dimension had
length 1).  If you provide any <code>index_</code> argument then the length
of the corresponding state dimension must match the index
length.</p></dd>


<dt id="arg-index-state">index_state<a class="anchor" aria-label="anchor" href="#arg-index-state"></a></dt>
<dd><p>An index to control which state variables we
set.  You can use this to set a subset of state variables.</p></dd>


<dt id="arg-index-particle">index_particle<a class="anchor" aria-label="anchor" href="#arg-index-particle"></a></dt>
<dd><p>An index to control which particles have
their state updated</p></dd>


<dt id="arg-index-group">index_group<a class="anchor" aria-label="anchor" href="#arg-index-group"></a></dt>
<dd><p>An index to control which groups have their
state updated.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Nothing, called for side effects only</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Consider a system with 3 particles and 1 group:</span></span></span>
<span class="r-in"><span><span class="va">sir</span> <span class="op">&lt;-</span> <span class="fu"><a href="dust_example.html">dust_example</a></span><span class="op">(</span><span class="st">"sir"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sys</span> <span class="op">&lt;-</span> <span class="fu"><a href="dust_system_create.html">dust_system_create</a></span><span class="op">(</span><span class="fu">sir</span><span class="op">(</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, n_particles <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># The state for this system is packed as S, I, R, cases_cumul, cases_inc:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_unpack.html">dust_unpack_index</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $S</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $I</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $R</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cases_cumul</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cases_inc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set all particles to the same state:</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000 1000 1000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10   10   10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    0    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can set everything to different states by passing a vector</span></span></span>
<span class="r-in"><span><span class="co"># with this shape:</span></span></span>
<span class="r-in"><span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">10</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">999</span>, <span class="fl">11</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">998</span>, <span class="fl">12</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="va">m</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000  999  998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10   11   12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    0    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or set the state for just one state:</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="fl">1</span>, index_state <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000  999  998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10   11   12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    1    1    1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    0    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># If you want to set a different state across particles, you must</span></span></span>
<span class="r-in"><span><span class="co"># provide a *matrix* (a vector always sets the same state into</span></span></span>
<span class="r-in"><span><span class="co"># every particle)</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, index_state <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000  999  998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10   11   12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    1    2    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    0    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This will not work as it can be ambiguous what you are</span></span></span>
<span class="r-in"><span><span class="co"># trying to do:</span></span></span>
<span class="r-in"><span><span class="co">#&gt; dust_system_set_state(sys, c(1, 2, 3), index_state = 4)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># State can be set for specific particles:</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">900</span>, <span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, index_particle <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000  900  998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10  100   12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    1    0    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    0    0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># And you can combine 'index_particle' with 'index_state' to set</span></span></span>
<span class="r-in"><span><span class="co"># small rectangles of state:</span></span></span>
<span class="r-in"><span><span class="fu">dust_system_set_state</span><span class="op">(</span><span class="va">sys</span>, <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      index_particle <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, index_state <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="dust_system_state.html">dust_system_state</a></span><span class="op">(</span><span class="va">sys</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      [,1] [,2] [,3]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 1000  900  998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]   10  100   12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]    0    0    0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]    1    1    3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    0    2    4</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

