<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create mcstate model — dust_filter_mcstate • dust2</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create mcstate model — dust_filter_mcstate"><meta name="description" content="Create a mcstate_model from a dust_filter object."><meta property="og:description" content="Create a mcstate_model from a dust_filter object."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dust2</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Details</h6></li>
    <li><a class="dropdown-item" href="../articles/periodic.html">Periodic variables details</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mrc-ide/dust2/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create mcstate model</h1>
      <small class="dont-index">Source: <a href="https://github.com/mrc-ide/dust2/blob/main/R/mcstate.R" class="external-link"><code>R/mcstate.R</code></a></small>
      <div class="d-none name"><code>dust_filter_mcstate.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Create a mcstate_model from a <code>dust_filter</code> object.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">dust_filter_mcstate</span><span class="op">(</span></span>
<span>  <span class="va">filter</span>,</span>
<span>  <span class="va">packer</span>,</span>
<span>  initial <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  domain <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  failure_is_impossible <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-filter">filter<a class="anchor" aria-label="anchor" href="#arg-filter"></a></dt>
<dd><p>A <code>dust_filter</code> object, created from <a href="dust_filter_create.html">dust_filter_create</a></p></dd>


<dt id="arg-packer">packer<a class="anchor" aria-label="anchor" href="#arg-packer"></a></dt>
<dd><p>A parameter packer, which will convert between an
unstructured vector of parameters as used in an MCMC into the
list of parameters that the dust system requires.</p></dd>


<dt id="arg-initial">initial<a class="anchor" aria-label="anchor" href="#arg-initial"></a></dt>
<dd><p>Optionally, a function to create initial conditions
from unpacked parameters.</p></dd>


<dt id="arg-domain">domain<a class="anchor" aria-label="anchor" href="#arg-domain"></a></dt>
<dd><p>Optionally, domain information to pass into the
model.  If given, this is a two column matrix with row names
corresponding to the parameter names in <code>packer</code>, the first
column representing the lower bound and the second column
representing the upper bound.  You do not need to specify
parameters that have a domain of <code>(-Inf, Inf)</code> as this is
assumed.  We use <a href="https://mrc-ide.github.io/mcstate2/reference/mcstate_domain_expand.html" class="external-link">mcstate2::mcstate_domain_expand</a> to expand
logical parameters, so if you have a vector-valued parameter <code>b</code>
and a domain entry called <code>b</code> we will expand this to all
elements of <code>b</code>.</p></dd>


<dt id="arg-failure-is-impossible">failure_is_impossible<a class="anchor" aria-label="anchor" href="#arg-failure-is-impossible"></a></dt>
<dd><p>Logical, indicating if an error while
computing the likelihood should be treated as a log-density of
<code>-Inf</code> (i.e., that this point is impossible).  This is a big
hammer to use, and you would be better off using the domain
(with reflecting boundaries) or the priors to control this if
possible.  However, sometimes you can have integration failures
with very high parameter values, or just other pathalogical
parameter sets where, once you understand the model, giving up
on that parameter set and continuing is the best option.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <a href="https://mrc-ide.github.io/mcstate2/reference/mcstate_model.html" class="external-link">mcstate2::mcstate_model</a> object</p>
    </div>
    <div class="section level2">
    <h2 id="random-number-streams">Random number streams<a class="anchor" aria-label="anchor" href="#random-number-streams"></a></h2>
    <p>The short version: the seed argument that you may have passed to
<a href="dust_filter_create.html">dust_filter_create</a> will be ignored when using a
<code>dust_filter_mcstate</code> model with algorithms from mcstate2.  You
should generally not worry about this, it is expected.</p>
<p>When you initialise a filter, you provide a random number seed
argument.  Your filter will use <code>n_groups * (n_particles + 1)</code>
streams (one for the filter for each group, then for each group
one per particle).  If you run the filter directly (e.g., with
<a href="dust_filter_run.html">dust_filter_run</a> then you will advance the state of the filter).
However, if you use the filter with mcstate2 (which is why you're
using <code>dust_filter_mcstate</code>) we will ignore this seeding.</p>
<p>When running mcmc with <code>n_chains</code> chains, we need <code>n_chains * n_groups * (n_particles + 1)</code> random number streams - that is
enough streams for every chain to have a filter with its own set
of chains.  mcstate2 will look after this for us, but the upshot
is that the random number state that you may have previously set
when building the filter will be ignored as we need to create a
series of suitable seeds.</p>
<p>The seeds provided by mcstate will start at some point in the RNG
state space (2^256 possible states by default).  In an MCMC, each
chain will have a seed that is created by performing a
"long jump", moving 2^192 steps along the chain.  Then within each
chain we will take a series of "jumps" (2^128 steps) for each of
the streams we need across the groups, filters and particles.
This ensures independence across the stochastic components of the
system but also the reproducibility and predictability of the
system.  The initial seeding performed by mcstate2 will respond to
R's RNG (i.e., it will follow <code>set.seed</code>) if an explicit seed is
not given.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rich FitzJohn.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

